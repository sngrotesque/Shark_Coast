一 什么是CFB模式

CFB模式全称Cipher FeedBack模式（密文反馈模式）。在CFB模式中，前一个密文分组会被送回到密码算法的输入端。所谓反馈，这里指的就是返回输入端的意思。

![](wiki_cfb_encryption_origin.png)
![](wiki_cfb_decryption_origin.png)

在ECB模式和CBC模式中，明文分组都是通过密码算法进行加密的，然而，在CFB模式中，明文分组并没有通过密码算法来直接进行加密。

明文分组和密文分组之间并没有经过“加密”这一步骤。在CFB模式中，明文分组和密文分组之间只有一个XOR。

CBC模式和CFB模式比较

![](https://img-blog.csdn.net/20180903220139811?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NoZW5ncWl1bWluZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

二 初始化向量

在生成第一个密文分组时，由于不存在前一个输出的数据，因此需要使用初始化向量（IV）来代替。一般来说，我们需要在每次加密时生成一个不同的随机比特序列用作初始化向量。

三 CFB模式与流密码

CFB模式的结构和一次性密码本非常相似。一次性密码本是通过“明文”与“随机比特序列”进行XOR运算来生成“密文”的。而CFB模式则是通过将“明文分组”与“密码算法的输出”进行XOR运算来生成“密文分组”的。在通过 XOR来进行加密这一点上，两者是非常相似的。

在CFB模式中，密码算法的输出相对于一次性密码本中的随机比特序列。由于密码算法的输出是通过计算得到的，并不是真正的随机数，因此CFB模式不可能像一次性密码本那样具备理论上不可破译的性质。

CFB模式中由密码算法所生成的比特序列称为密钥流。在CFB模式中，密码算法相对于用来生成密钥流的伪随机数生成器，而初始化向量相当于伪随机数生成器的“种子”。

在CFB模式中，明文数据可以被逐比特加密，因此可以将CFB模式看作是一种使用分组密码来实现流密码的方式。

四 CFB模式的解密

CFB模式解密时，需要注意的是分组密码算法依然执行加密操作，密钥流是通过加密操作来生成的。

五 对CFB的攻击

对CFB模式可以实施重放攻击。 

Alice向Bob发送一条消息，这条消息由4个密文分组组成。主动攻击者将该消息中的后3个密文分组保存了下来。第二天，Alice又向Bob发送了内容不同的4个密文分组（假设Alice使用了相同的密钥）。攻击者用昨天保存下来的3个密文分别将今天发送的后3个密文分组进行了替换。

于是，Bob解密时，4个分组中只有第1个可以解密成正确的明文分组，第2个会出错，而第3个和第4个则变成了被攻击者替换的内容（也就是昨天发送的明文内容）。攻击者没有破解密码，就成功地将以前的电文混入了新电文中。而第2个分组出错到底是通信错误呢，还是被人攻击所造成的呢？Bob是无法做出判断的。

![](https://img-blog.csdn.net/20180903220450915?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NoZW5ncWl1bWluZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)